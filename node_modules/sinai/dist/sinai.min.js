/*!
 * Sinai v0.2.1
 * https://github.com/ktsn/sinai
 *
 * @license
 * Copyright (c) 2017 katashin
 * Released under the MIT license
 * https://github.com/ktsn/sinai/blob/master/LICENSE
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Sinai={})}(this,function(t){"use strict";var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function u(t){return t}function o(t,e){return t.reduce(function(t,e){return t[e]},e)}function s(t,e){return function(){return e.apply(t,arguments)}}function c(t,i,u){return function(o){function t(t,e){var n=o.call(this,t,e)||this,r=e.getProxy(u);return n.modules[i]=r,n}return n(t,o),t}(t)}var e=function(t,e){var n=e.getProxy(t);this.__proxy__=n},i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.modules={},t}return n(t,e),t}(e),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return this.__proxy__.state},enumerable:!0,configurable:!0}),e}(i),f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return this.__proxy__.state},enumerable:!0,configurable:!0}),e}(e),p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return this.__proxy__.state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getters",{get:function(){return this.__proxy__.getters},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mutations",{get:function(){return this.__proxy__.mutations},enumerable:!0,configurable:!0}),e}(i);var h=function(){function t(t,e){var n=e.state,r=e.getters,o=e.mutations,i=e.actions;this.uid=t,this.children={},this.State=n,this.Getters=r,this.Mutations=o,this.Actions=i}return t.prototype.initState=function(){return this.State?new this.State:{}},t.prototype.initGetters=function(t,o){if(void 0===o&&(o=u),!this.Getters)return{};var i=new this.Getters(this,t);return d(this.Getters.prototype,a,function(t,e){if("function"==typeof t.get){var n=t.get;t.get=function(){return n.call(i)}}else if("function"==typeof t.value){var r=t.value;t.value=function(){return r.apply(i,arguments)}}Object.defineProperty(i,e,o(t,e))}),i},t.prototype.initMutations=function(t,r){if(void 0===r&&(r=u),!this.Mutations)return{};var o=new this.Mutations(this,t);return d(this.Mutations.prototype,f,function(t,e){var n=t.value;t.value=function(){n.apply(o,arguments)},Object.defineProperty(o,e,r(t,e))}),o},t.prototype.initActions=function(t,r){if(void 0===r&&(r=u),!this.Actions)return{};var o=new this.Actions(this,t);return d(this.Actions.prototype,p,function(t,e){var n=t.value;t.value=function(){return n.apply(o,arguments)},Object.defineProperty(o,e,r(t,e))}),o},t.prototype.child=function(t,e){return this.children[t]=e,this},t}(),l=function(){function t(t,e){this.path=t,this.store=e}return Object.defineProperty(t.prototype,"state",{get:function(){return o(this.path,this.store.state)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"getters",{get:function(){return o(this.path,this.store.getters)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mutations",{get:function(){return o(this.path,this.store.mutations)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){return o(this.path,this.store.actions)},enumerable:!0,configurable:!0}),t}(),y=0;function d(n,t,r,o){void 0===o&&(o={constructor:!0}),n.constructor!==t&&(Object.getOwnPropertyNames(n).forEach(function(t){if(!o[t]){o[t]=!0;var e=Object.getOwnPropertyDescriptor(n,t);r(e,t)}}),d(Object.getPrototypeOf(n),t,r,o))}var m=function(){function t(t,e){void 0===e&&(e={}),this.moduleMap={},this.subscribers=[],this.transformGetter=e.transformGetter||u,this.transformMutation=e.transformMutation||u,this.transformAction=e.transformAction||u,this.registerModule(t,!1)}return t.prototype.replaceState=function(t){this.state=t},t.prototype.subscribe=function(t){var e=this;return this.subscribers.push(t),function(){e.subscribers.splice(e.subscribers.indexOf(t),1)}},t.prototype.registerModule=function(t,e){this.registerModuleLoop([],t);var n=this.initModuleAssets([],t);e||(this.state=n.state),this.getters=n.getters,this.mutations=n.mutations,this.actions=n.actions},t.prototype.getProxy=function(t){var e=this.moduleMap[t.uid];return null==e?null:e.proxy},t.prototype.hotUpdate=function(t){this.moduleMap={},this.registerModule(t,!0)},t.prototype.registerModuleLoop=function(e,n){var r=this;this.moduleMap[n.uid]={path:e,module:n,proxy:new l(e,this)},Object.keys(n.children).forEach(function(t){r.registerModuleLoop(e.concat(t),n.children[t])})},t.prototype.initModuleAssets=function(r,t){var e,n,o=this,i={state:t.initState(),getters:t.initGetters(this,v(r,this.transformGetter)),mutations:t.initMutations(this,v(r,s(this,this.hookMutation))),actions:t.initActions(this,v(r,this.transformAction))};return e=t.children,n=function(t,e){var n=o.initModuleAssets(r.concat(e),t);i.state[e]=n.state,i.getters[e]=n.getters,i.mutations[e]=n.mutations,i.actions[e]=n.actions},Object.keys(e).forEach(function(t){n(e[t],t)}),i},t.prototype.hookMutation=function(t,n){var r=this,o=t.value;return t.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.apply(void 0,e),r.subscribers.forEach(function(t){return t(n,e,r.state)})},this.transformMutation(t,n)},t}();function v(n,r){return function(t,e){return r(t,n.concat(e))}}"undefined"!=typeof window&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;var g,b=function(){function t(t,e){var n=this;this.gettersForComputed={},this.strict=Boolean(e.strict),this.innerStore=new m(t,{transformGetter:s(this,this.transformGetter),transformMutation:s(this,this.transformMutation)}),this.setupStoreVM(),this.watcher=new g,Object.defineProperty(this.innerStore,"state",{get:function(){return n.state},set:function(t){n.vm.$data.state=t}}),this.strict&&this.watch(function(t){return t},function(){!function(t,e){if(!t)throw new Error("[sinai] "+e)}(!n.strict,"Must not update state out of mutations when strict mode is enabled.")},{deep:!0,sync:!0}),(e.plugins||[]).forEach(function(t){return t(n)})}return Object.defineProperty(t.prototype,"state",{get:function(){return this.vm.$data.state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"getters",{get:function(){return this.innerStore.getters},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mutations",{get:function(){return this.innerStore.mutations},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){return this.innerStore.actions},enumerable:!0,configurable:!0}),t.prototype.replaceState=function(t){var e=this;this.commit(function(){e.vm.$data.state=t})},t.prototype.subscribe=function(t){return this.innerStore.subscribe(t)},t.prototype.watch=function(t,e,n){var r=this;return this.watcher.$watch(function(){return t(r.state,r.getters)},e,n)},t.prototype.hotUpdate=function(t){this.gettersForComputed={},this.innerStore.hotUpdate(t),this.setupStoreVM()},t.prototype.transformGetter=function(t,e){var n=this;if("function"!=typeof t.get)return t;var r=e.join(".");return this.gettersForComputed[r]=t.get,t.get=function(){return n.vm[r]},t},t.prototype.transformMutation=function(t){var n=this;if(!this.strict)return t;var r=t.value;return t.value=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];n.commit(function(){return r.apply(null,t)})},t},t.prototype.setupStoreVM=function(){var t=this.vm;this.vm=new g({data:{state:this.innerStore.state},computed:this.gettersForComputed}),null!=t&&(this.commit(function(){t.$data.state=null}),g.nextTick(function(){t.$destroy()}))},t.prototype.commit=function(t){var e=this.strict;this.strict=!1,t(),this.strict=e},t}();function _(){var t=this,e=t.$options.store;e?t.$store=e:t.$parent&&t.$parent.$store&&(t.$store=t.$parent.$store)}function M(e,n){var r={};return Array.isArray(e)?e.forEach(function(t){r[t]=n(t,t)}):Object.keys(e).forEach(function(t){r[t]=n(e[t],t)}),r}var O=function(){function e(t){this._module=t}return e.prototype.module=function(t){return new e(this._module.concat(t))},e.prototype.mapState=function(t){var n=this;return M(t,function(t){var e=n._module.concat(t);return function(){return o(e,this.$store.state)}})},e.prototype.mapGetters=function(t){var n=this;return M(t,function(t){var e=n._module.concat(t);return function(){return o(e,this.$store.getters)}})},e.prototype.mapMutations=function(t){var e=this;return M(t,function(t){var n=e._module.concat(t);return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return o(n,this.$store.mutations).apply(void 0,t)}})},e.prototype.mapActions=function(t){var e=this;return M(t,function(t){var n=e._module.concat(t);return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return o(n,this.$store.actions).apply(void 0,t)}})},e}();t.module=function(t){return void 0===t&&(t={}),new h(++y,t)},t.inject=function(t,e){return function n(r,o,i){return{Getters:function(){return r},Mutations:function(){return o},Actions:function(){return i},and:function(t,e){return n(c(r,t,e),o,c(i,t,e))}}}(a,f,p).and(t,e)},t.Getters=function(){return a},t.Mutations=function(){return f},t.Actions=function(){return p},t.convertVuexPlugin=function(t){return function(i){t({get state(){return i.state},get getters(){return t=i.getters,u="/",function n(r,o,i){return Object.keys(i).forEach(function(t){if("__proxy__"!==t&&"modules"!==t){var e=i[t];e&&e.__proto__ instanceof a?n(r,o.concat(t),e):Object.defineProperty(r,o.concat(t).join(u),{get:function(){return i[t]},enumerable:!0,configurable:!0})}}),r}({},[],t);var t,u},replaceState:function(t){i.replaceState(t)},dispatch:function(t,e){"string"!=typeof t&&(t=(e=t).type);var n,r=t.split("/").reduce(function(t,e){return t[e]},i.actions)(e);return null!=(n=r)&&"function"==typeof n.then?r:Promise.resolve(r)},commit:function(t,e){"string"!=typeof t&&(t=(e=t).type),t.split("/").reduce(function(t,e){return t[e]},i.mutations)(e)},subscribe:function(o){return i.subscribe(function(t,e,n){var r=t.join("/");o({type:r,payload:e[0]},n)})},watch:function(t,e,n){var r=this;return i.watch(function(){return t(r.state,r.getters)},e,n)},registerModule:function(){throw new Error("[sinai:vuex-plugin-adapter] registerModule is not supported")},unregisterModule:function(){throw new Error("[sinai:vuex-plugin-adapter] unregisterModule is not supported")}})}},t.store=function(t,e){return void 0===e&&(e={}),new b(t,e)},t.install=function(t){(g=t).mixin({beforeCreate:_})},t.createMapper=function(){return new O([])},Object.defineProperty(t,"__esModule",{value:!0})});
